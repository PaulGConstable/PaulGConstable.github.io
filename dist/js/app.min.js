function app(){"use strict";function e(){t=new google.maps.Map(document.getElementById("map"),{center:new google.maps.LatLng(51.45021,2.180518),zoom:6})}function a(){e(),o=new r,ko.applyBindings(o)}var t,o,n=[{name:"Hadlow College, Tonbridge",lat:51.223217,lng:.331976,stravaID:127445893},{name:"Channel 4, London",lat:51.496026,lng:-.132962,stravaID:150243926},{name:"Olympic Park, London",lat:51.546307,lng:-.020001,stravaID:359827471},{name:"Amsterdam, Netherlands",lat:52.361212,lng:4.878265,stravaID:168304053},{name:"Dieppe, France",lat:49.933543,lng:1.08905,stravaID:151990703}],i=function(e){this.name=ko.observable(e.name),this.lat=ko.observable(e.lat),this.lng=ko.observable(e.lng),this.stravaID=ko.observable(e.stravaID),this.marker=ko.observable()},r=function(e){var a=this;this.locationList=ko.observableArray([]),this.cycleSearch=ko.observable(""),this.visibleRides=ko.observableArray(),n.forEach(function(e){a.locationList.push(new i(e))});var o,r,s=new google.maps.InfoWindow,l=setTimeout(function(){alert("Error: Sorry, Strava data could not be loaded. Please refresh the page.")},3e3);a.locationList().forEach(function(e){function a(){e.marker.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){e.marker.setAnimation(null)},1400)}o=new google.maps.Marker({position:new google.maps.LatLng(e.lat(),e.lng()),map:t,animation:google.maps.Animation.DROP});var n="https://www.strava.com/api/v3/activities/"+e.stravaID()+"?per_page=200&access_token=01d55b235d8b40e4733bc5b843c2d61c5e13911a";$.ajax({url:n,dataType:"jsonp",jsonp:"callback",success:function(a){e.routeMap=a.map.polyline,e.distance=.000621371192*a.distance,e.time=a.moving_time/3600,e.speed=2.23693629*a.average_speed,e.url="http://www.strava.com/activities/"+a.id,clearTimeout(l)},error:function(e){alert("Sorry, Strava data could not be loaded. Please refresh the page.")}}),e.marker=o,e.marker.addListener("click",function(){a(),s.setContent('<div class="info-content"><h2>'+e.name()+'</h2><div class="body-content"><p>Cycle distance: '+e.distance.toFixed(2)+" miles</p><p>Average speed: "+e.speed.toFixed(2)+"mph</p><p>Rough Moving Time: "+e.time.toFixed(0)+' hours</p><p></b><a href="'+e.url+'">See ride on Strava</a></b></p></div></div>'),s.open(t,e.marker),google.maps.event.addListener(s,"closeclick",function(){r.setMap(null),e.marker.setAnimation(null)}),t.setZoom(8),t.panTo(e.marker.getPosition());var o=google.maps.geometry.encoding.decodePath(e.routeMap);r=new google.maps.Polyline({path:o,strokeColor:"#FF0000",strokeOpacity:1,strokeWeight:5,map:t})})}),a.locationList().forEach(function(e){a.visibleRides.push(e)}),a.cycleFiltered=function(){var e=a.cycleSearch().toLowerCase(),t=document.getElementById("drawer");a.visibleRides.removeAll(),a.locationList().forEach(function(o){o.marker.setVisible(!1),t.classList.add("open"),-1!==o.name().toLowerCase().indexOf(e)&&a.visibleRides.push(o)}),a.visibleRides().forEach(function(e){e.marker.setVisible(!0)})},a.displayRide=function(e){return google.maps.event.trigger(e.marker,"click",{})},a.mobileNavToggle=function(e){var a=document.querySelector("#menu"),t=document.querySelector("content"),o=document.querySelector(".rides-container"),n=document.getElementById("drawer");a.addEventListener("click",function(e){o.classList.toggle("open")}),t.addEventListener("click",function(){o.classList.remove("open")}),n.classList.remove("open")}};a()}