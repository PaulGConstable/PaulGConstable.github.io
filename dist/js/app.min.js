var favLocations=[{name:"Hadlow College, Tonbridge",lat:51.223217,lng:.331976,stravaID:127445893},{name:"Channel 4, London",lat:51.496026,lng:-.132962,stravaID:150243926},{name:"Olympic Park, London",lat:51.546307,lng:-.020001,stravaID:359827471},{name:"Amsterdam, Netherlands",lat:52.361212,lng:4.878265,stravaID:168304053},{name:"Dieppe, France",lat:49.933543,lng:1.08905,stravaID:151990703}],markers=function(e){this.name=ko.observable(e.name),this.lat=ko.observable(e.lat),this.lng=ko.observable(e.lng),this.stravaID=ko.observable(e.stravaID),this.marker=ko.observable()},viewModel=function(e){var a=new google.maps.Map(document.getElementById("map"),{center:new google.maps.LatLng(51.45021,2.180518),zoom:6}),t=this;this.locationList=ko.observableArray([]),this.cycleSearch=ko.observable(""),t.cycleFiltered=ko.pureComputed(function(){var e=t.cycleSearch().toLowerCase(),a=document.getElementById("drawer");return e?(a.classList.add("open"),ko.utils.arrayFilter(t.locationList(),function(a){return a.name().toLowerCase().indexOf(e)>-1})):t.locationList()}),favLocations.forEach(function(e){t.locationList.push(new markers(e))});var o,n,i=new google.maps.InfoWindow;this.locationList().forEach(function(e){function t(){null!==e.marker.getAnimation()?e.marker.setAnimation(null):e.marker.setAnimation(google.maps.Animation.BOUNCE)}o=new google.maps.Marker({position:new google.maps.LatLng(e.lat(),e.lng()),map:a,title:e.name(),animation:google.maps.Animation.DROP});var r="https://www.strava.com/api/v3/activities/"+e.stravaID()+"?per_page=200&access_token=01d55b235d8b40e4733bc5b843c2d61c5e13911a";$.ajax({url:r,dataType:"jsonp",jsonp:"callback",success:function(a){e.routeMap=a.map.polyline,e.distance=.000621371192*a.distance,e.time=a.moving_time/3600,e.speed=2.23693629*a.average_speed,e.url="http://www.strava.com/activities/"+a.id},error:function(){console.log("Strava data could not be loaded")}}),e.marker=o,e.marker.addListener("click",function(){t(),i.setContent('<div class="info-content"><h1>'+e.name()+'</h1><div class="body-content"><p>Cycle distance: '+e.distance.toFixed(2)+" miles</p><p>Average speed: "+e.speed.toFixed(2)+"mph</p><p>Rough Moving Time: "+e.time.toFixed(0)+' hours</p><p></b><a href="'+e.url+'">See ride on Strava</a></b></p></div></div>'),i.open(a,e.marker),google.maps.event.addListener(i,"closeclick",function(){n.setMap(null),e.marker.setAnimation(null)}),a.setZoom(8),a.setCenter(e.marker.getPosition());var o=google.maps.geometry.encoding.decodePath(e.routeMap);n=new google.maps.Polyline({path:o,strokeColor:"#FF0000",strokeOpacity:1,strokeWeight:5,map:a})})}),this.displayRide=function(e){google.maps.event.trigger(e.marker,"click",{})},this.mobileNavToggle=function(e){var a=document.querySelector("#menu"),t=document.querySelector("content"),o=document.querySelector(".rides-container"),n=document.getElementById("drawer");a.addEventListener("click",function(e){o.classList.toggle("open")}),t.addEventListener("click",function(){o.classList.remove("open")}),n.classList.remove("open")}};ko.applyBindings(new viewModel);